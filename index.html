<script>
    // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
    const DIFFICULTY = {
        easy: { ballSpeed: 4, aiSpeed: 3, aiAccuracy: 0.7 },
        hard: { ballSpeed: 6, aiSpeed: 4, aiAccuracy: 0.85 },
        ultra: { ballSpeed: 8, aiSpeed: 5, aiAccuracy: 0.95 }
    };
    
    const PHRASES = {
        win: [
            "–ü–æ–±–µ–¥–∞! üèÜ", "–û—Ç–ª–∏—á–Ω–æ! üéØ", "AI –ø–æ–≤–µ—Ä–∂–µ–Ω! ü§ñ", 
            "–ú–∞—Å—Ç–µ—Ä –ø–∏–Ω–≥-–ø–æ–Ω–≥–∞! üëë", "–ë—Ä–∞–≤–æ! ‚ú®", "–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! üöÄ"
        ],
        lose: [
            "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞", "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë! üîÑ", "AI —Å–∏–ª—å–Ω–µ–µ...", 
            "–ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å! ‚ö°", "–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å! üèì", "–í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑! üí™"
        ]
    };
    
    // ========== –°–ò–°–¢–ï–ú–ê –ë–ê–§–û–í ==========
    const BUFFS = {
        BIG_BALL: {
            id: 'big_ball',
            name: 'üî• –ë–æ–ª—å—à–æ–π –º—è—á',
            duration: 240,
            effect: 'size',
            multiplier: 2.0,
            color: '#FF9800',
            icon: 'üî•'
        },
        SPEED_BOOST: {
            id: 'speed_boost',
            name: '‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ',
            duration: 180,
            effect: 'speed',
            multiplier: 1.5,
            color: '#2196F3',
            icon: '‚ö°'
        },
        COLOR_CHANGE: {
            id: 'color_change',
            name: 'üåà –¶–≤–µ—Ç–Ω–æ–π –º—è—á',
            duration: 300,
            effect: 'color',
            colors: ['#FF5252', '#4CAF50', '#2196F3', '#FFEB3B', '#E91E63'],
            icon: 'üåà',
            bonusPoints: 1
        }
    };
    
    // ========== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ==========
    let canvas, ctx;
    let game = {
        active: false,
        paused: false,
        difficulty: 'easy',
        playerScore: 0,
        opponentScore: 0,
        sound: true,
        showMobile: true,
        ballSpeed: 5,
        buffsEnabled: true
    };
    
    // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
    let player, opponent, ball;
    let keys = {};
    
    // –°–∏—Å—Ç–µ–º–∞ –±–∞—Ñ–æ–≤
    let buffSystem = {
        cooldown: 1800,
        activeBuff: null,
        activeUntil: 0,
        buffIcon: { x: 0, y: 0, type: null, visible: false, speed: 0 },
        hitsWithColor: 0,
        originalBallSize: 10,
        originalBallSpeed: 5
    };
    
    // ========== –ó–í–£–ö–ò ==========
    function beep(freq, duration) {
        if (!game.sound) return;
        
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = freq;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
            console.log("Audio not supported");
        }
    }
    
    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => {
            s.style.display = 'none';
        });
        const screen = document.getElementById(screenId);
        if (screen) {
            screen.style.display = 'flex';
        }
    }
    
    function backToMenu() {
        game.active = false;
        showScreen('menuScreen');
    }
    
    function setDifficulty(diff) {
        game.difficulty = diff;
        const names = { easy: '–õ–ï–ì–ö–ê–Ø', hard: '–°–õ–û–ñ–ù–ê–Ø', ultra: '–£–õ–¨–¢–†–ê' };
        const colors = { easy: 'easy-badge', hard: 'hard-badge', ultra: 'ultra-badge' };
        
        document.getElementById('difficultyBadge').textContent = names[diff];
        document.getElementById('difficultyBadge').className = `difficulty-badge ${colors[diff]}`;
        
        backToMenu();
    }
    
    function saveSettings() {
        game.sound = document.getElementById('soundToggle').checked;
        game.showMobile = document.getElementById('mobileButtons').checked;
        game.buffsEnabled = document.getElementById('buffsToggle').checked;
        game.ballSpeed = parseInt(document.getElementById('ballSpeed').value);
        document.getElementById('speedValue').textContent = game.ballSpeed;
        
        document.getElementById('mobileControls').classList.toggle('hidden', !game.showMobile);
        localStorage.setItem('pingpongSettings', JSON.stringify(game));
        
        backToMenu();
    }
    
    // ========== –ó–ê–ü–£–°–ö –ò–ì–†–´ ==========
    function startGame() {
        showScreen('gameScreen');
        initGame();
    }
    
    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ==========
    function initGame() {
        // Canvas
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä
        const container = canvas.parentElement;
        const maxWidth = Math.min(500, container.clientWidth - 20);
        canvas.width = maxWidth;
        canvas.height = Math.min(400, window.innerHeight * 0.5);
        
        // –û–±—ä–µ–∫—Ç—ã
        player = {
            x: 15,
            y: canvas.height / 2 - 50,
            width: 10,
            height: 100,
            speed: 6
        };
        
        opponent = {
            x: canvas.width - 25,
            y: canvas.height / 2 - 50,
            width: 10,
            height: 100,
            speed: DIFFICULTY[game.difficulty].aiSpeed
        };
        
        ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            size: 10,
            dx: game.ballSpeed * (Math.random() > 0.5 ? 1 : -1),
            dy: game.ballSpeed * (Math.random() > 0.5 ? 1 : -1),
            originalColor: '#FFFFFF'
        };
        
        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        game.playerScore = 0;
        game.opponentScore = 0;
        game.active = true;
        game.paused = false;
        
        // –°–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã –±–∞—Ñ–æ–≤
        buffSystem = {
            cooldown: 1800,
            activeBuff: null,
            activeUntil: 0,
            buffIcon: { x: 0, y: 0, type: null, visible: false, speed: 0 },
            hitsWithColor: 0,
            originalBallSize: ball.size,
            originalBallSpeed: game.ballSpeed
        };
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–∞—Ñ–æ–≤
        document.getElementById('buffsIndicator').style.display = 'block';
        document.getElementById('buffStatus').textContent = 
            game.buffsEnabled ? '–ë–∞—Ñ—ã: üü¢ –í–∫–ª' : '–ë–∞—Ñ—ã: üî¥ –í—ã–∫–ª';
        document.getElementById('activeBuffInfo').style.display = 'none';
        
        updateScore();
        setupControls();
        document.getElementById('mobileControls').classList.toggle('hidden', !game.showMobile);
        document.getElementById('pauseBtn').textContent = '‚è∏ –ü–ê–£–ó–ê';
        
        gameLoop();
    }
    
    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
    function setupControls() {
        keys = {};
        
        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        document.onkeydown = (e) => {
            const key = e.key.toLowerCase();
            if (['w', 's', 'arrowup', 'arrowdown', ' ', 'p'].includes(key)) {
                keys[key] = true;
                if ((key === ' ' || key === 'p') && game.active) {
                    pauseGame();
                    e.preventDefault();
                }
            }
        };
        
        document.onkeyup = (e) => {
            const key = e.key.toLowerCase();
            if (['w', 's', 'arrowup', 'arrowdown'].includes(key)) {
                keys[key] = false;
            }
        };
        
        // –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        
        upBtn.ontouchstart = upBtn.onmousedown = () => {
            keys['arrowup'] = true;
        };
        
        upBtn.ontouchend = upBtn.onmouseup = upBtn.onmouseleave = () => {
            keys['arrowup'] = false;
        };
        
        downBtn.ontouchstart = downBtn.onmousedown = () => {
            keys['arrowdown'] = true;
        };
        
        downBtn.ontouchend = downBtn.onmouseup = downBtn.onmouseleave = () => {
            keys['arrowdown'] = false;
        };
    }
    
    // ========== –°–ò–°–¢–ï–ú–ê –ë–ê–§–û–í ==========
    function updateBuffs() {
        if (!game.buffsEnabled || !game.active) return;
        
        // –¢–∞–π–º–µ—Ä –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
        if (buffSystem.cooldown > 0 && !buffSystem.buffIcon.visible) {
            buffSystem.cooldown--;
            
            // –ü–æ—è–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –±–∞—Ñ–∞
            if (buffSystem.cooldown <= 0) {
                spawnBuffIcon();
                buffSystem.cooldown = 1800;
            }
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –±–∞—Ñ–∞ (–ø—É–ª—å—Å–∞—Ü–∏—è)
        if (buffSystem.buffIcon.visible) {
            // –ü—Ä–æ—Å—Ç–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è
            buffSystem.buffIcon.y = 80 + Math.sin(Date.now() / 500) * 10;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Ä–∞–∫–µ—Ç–∫–æ–π
        if (buffSystem.buffIcon.visible) {
            const icon = buffSystem.buffIcon;
            if (icon.x > player.x - 30 && icon.x < player.x + player.width + 30 &&
                icon.y > player.y - 30 && icon.y < player.y + player.height + 30) {
                
                activateBuff(icon.type);
                buffSystem.buffIcon.visible = false;
                if (game.sound) beep(1200, 0.3);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ñ–∞
        if (buffSystem.activeBuff) {
            buffSystem.activeUntil--;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
            const secondsLeft = Math.ceil(buffSystem.activeUntil / 60);
            document.getElementById('activeBuffInfo').textContent = 
                `${buffSystem.activeBuff.icon} ${buffSystem.activeBuff.name}: ${secondsLeft}—Å`;
            
            if (buffSystem.activeUntil <= 0) {
                deactivateBuff();
            }
        }
    }
    
    function spawnBuffIcon() {
        if (buffSystem.activeBuff || buffSystem.buffIcon.visible) return;
        
        const buffTypes = Object.values(BUFFS);
        const randomBuff = buffTypes[Math.floor(Math.random() * buffTypes.length)];
        
        buffSystem.buffIcon = {
            x: 100 + Math.random() * (canvas.width - 200),
            y: 80,
            type: randomBuff,
            visible: true,
            speed: 0
        };
    }
    
    function activateBuff(buff) {
        buffSystem.activeBuff = buff;
        buffSystem.activeUntil = buff.duration;
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        if (buff.effect === 'size') {
            ball.size = buffSystem.originalBallSize * buff.multiplier;
        } else if (buff.effect === 'speed') {
            ball.dx *= buff.multiplier;
            ball.dy *= buff.multiplier;
        } else if (buff.effect === 'color') {
            buffSystem.hitsWithColor = 0;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
        document.getElementById('activeBuffInfo').style.display = 'block';
    }
    
    function deactivateBuff() {
        if (!buffSystem.activeBuff) return;
        
        // –û—Ç–º–µ–Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        const buff = buffSystem.activeBuff;
        
        if (buff.effect === 'size') {
            ball.size = buffSystem.originalBallSize;
        } else if (buff.effect === 'speed') {
            ball.dx /= buff.multiplier;
            ball.dy /= buff.multiplier;
        } else if (buff.effect === 'color') {
            ball.originalColor = '#FFFFFF';
        }
        
        buffSystem.activeBuff = null;
        document.getElementById('activeBuffInfo').style.display = 'none';
    }
    
    function drawBuffs() {
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–∫–æ–Ω–∫–∏ –±–∞—Ñ–∞
        if (buffSystem.buffIcon.visible) {
            const icon = buffSystem.buffIcon;
            
            // –°–≤–µ—á–µ–Ω–∏–µ
            ctx.shadowColor = icon.type.color;
            ctx.shadowBlur = 15;
            
            // –ö—Ä—É–≥ –∏–∫–æ–Ω–∫–∏
            ctx.fillStyle = icon.type.color;
            ctx.beginPath();
            ctx.arc(icon.x, icon.y, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // –ò–∫–æ–Ω–∫–∞
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(icon.type.icon, icon.x, icon.y);
            
            // –°–±—Ä–æ—Å —Ç–µ–Ω–∏
            ctx.shadowBlur = 0;
            
            // –ü–æ–¥—Å–∫–∞–∑–∫–∞
            ctx.fillStyle = '#FF9800';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('–°–æ–±–µ—Ä–∏!', icon.x, icon.y + 35);
        }
        
        // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –º—è—á–∞
        if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color') {
            const buff = buffSystem.activeBuff;
            const colorIndex = buffSystem.hitsWithColor % buff.colors.length;
            ctx.fillStyle = buff.colors[colorIndex];
        }
    }
    
    // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
    function update() {
        if (!game.active || game.paused) return;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—Ñ–æ–≤
        updateBuffs();
        
        // –ò–≥—Ä–æ–∫
        if ((keys['w'] || keys['arrowup']) && player.y > 0) {
            player.y -= player.speed;
        }
        if ((keys['s'] || keys['arrowdown']) && player.y < canvas.height - player.height) {
            player.y += player.speed;
        }
        
        // AI
        const diff = DIFFICULTY[game.difficulty];
        let targetY = ball.y - opponent.height / 2;
        
        if (Math.random() > diff.aiAccuracy) {
            targetY += (Math.random() - 0.5) * 70;
        }
        
        if (opponent.y < targetY && opponent.y < canvas.height - opponent.height) {
            opponent.y += Math.min(opponent.speed, targetY - opponent.y);
        }
        if (opponent.y > targetY && opponent.y > 0) {
            opponent.y -= Math.min(opponent.speed, opponent.y - targetY);
        }
        
        // –ú—è—á
        ball.x += ball.dx;
        ball.y += ball.dy;
        
        // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
        if (ball.y <= ball.size || ball.y >= canvas.height - ball.size) {
            ball.dy *= -1;
            beep(600, 0.1);
        }
        
        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
        const hitPlayer = ball.x - ball.size < player.x + player.width &&
                        ball.x + ball.size > player.x &&
                        ball.y > player.y && 
                        ball.y < player.y + player.height;
        
        const hitOpponent = ball.x + ball.size > opponent.x &&
                          ball.x - ball.size < opponent.x + opponent.width &&
                          ball.y > opponent.y && 
                          ball.y < opponent.y + opponent.height;
        
        if (hitPlayer) {
            ball.dx = Math.abs(ball.dx);
            ball.dy = 5 * ((ball.y - player.y) / player.height - 0.5);
            ball.x = player.x + player.width + ball.size;
            beep(800, 0.05);
            
            // –ü–æ–¥—Å—á–µ—Ç —É–¥–∞—Ä–æ–≤ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –±–∞—Ñ–∞
            if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color') {
                buffSystem.hitsWithColor++;
            }
        }
        
        if (hitOpponent) {
            ball.dx = -Math.abs(ball.dx);
            ball.dy = 5 * ((ball.y - opponent.y) / opponent.height - 0.5);
            ball.x = opponent.x - ball.size;
            beep(800, 0.05);
            
            // –ü–æ–¥—Å—á–µ—Ç —É–¥–∞—Ä–æ–≤ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –±–∞—Ñ–∞
            if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color') {
                buffSystem.hitsWithColor++;
            }
        }
        
        // –ì–æ–ª—ã
        if (ball.x - ball.size <= 0) {
            game.opponentScore++;
            
            if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color' && 
                buffSystem.activeBuff.bonusPoints) {
                game.opponentScore += buffSystem.activeBuff.bonusPoints;
            }
            
            resetBall();
            beep(300, 0.2);
        }
        
        if (ball.x + ball.size >= canvas.width) {
            game.playerScore++;
            
            if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color' && 
                buffSystem.activeBuff.bonusPoints) {
                game.playerScore += buffSystem.activeBuff.bonusPoints;
            }
            
            resetBall();
            beep(1000, 0.2);
        }
        
        updateScore();
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        if (game.playerScore >= 10 || game.opponentScore >= 10) {
            endGame();
        }
    }
    
    function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.dx = game.ballSpeed * (Math.random() > 0.5 ? 1 : -1);
        ball.dy = game.ballSpeed * (Math.random() > 0.5 ? 1 : -1);
        
        const config = DIFFICULTY[game.difficulty];
        ball.dx = Math.sign(ball.dx) * config.ballSpeed;
        ball.dy = Math.sign(ball.dy) * config.ballSpeed;
        
        ball.originalColor = '#FFFFFF';
    }
    
    function updateScore() {
        document.getElementById('scoreDisplay').textContent = 
            `${game.playerScore} : ${game.opponentScore}`;
    }
    
    // ========== –ö–û–ù–ï–¶ –ò–ì–†–´ ==========
    function endGame() {
        game.active = false;
        
        deactivateBuff();
        document.getElementById('buffsIndicator').style.display = 'none';
        
        const playerWon = game.playerScore >= 10;
        const phrases = playerWon ? PHRASES.win : PHRASES.lose;
        const phrase = phrases[Math.floor(Math.random() * phrases.length)];
        
        document.getElementById('gameOverTitle').textContent = 
            playerWon ? "üéâ –ü–û–ë–ï–î–ê!" : "üéÆ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê";
        document.getElementById('gameMessage').textContent = phrase;
        document.getElementById('finalScore').textContent = 
            `${game.playerScore} : ${game.opponentScore}`;
        
        setTimeout(() => showScreen('gameOverScreen'), 500);
    }
    
    function restartGame() {
        showScreen('gameScreen');
        initGame();
    }
    
    // ========== –ü–ê–£–ó–ê ==========
    function pauseGame() {
        if (!game.active) return;
        
        game.paused = !game.paused;
        document.getElementById('pauseBtn').textContent = 
            game.paused ? '‚ñ∂ –ü–†–û–î–û–õ–ñ–ò–¢–¨' : '‚è∏ –ü–ê–£–ó–ê';
        
        if (game.sound) beep(400, 0.1);
    }
    
    // ========== –û–¢–†–ò–°–û–í–ö–ê ==========
    function draw() {
        // –§–æ–Ω
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –õ–∏–Ω–∏—è
        ctx.setLineDash([5, 8]);
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.strokeStyle = '#333';
        ctx.stroke();
        ctx.setLineDash([]);
        
        // –†–∞–∫–µ—Ç–∫–∏
        ctx.fillStyle = '#4CAF50';
        ctx.fillRect(player.x, player.y, player.width, player.height);
        
        ctx.fillStyle = '#f44336';
        ctx.fillRect(opponent.x, opponent.y, opponent.width, opponent.height);
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∞—Ñ–æ–≤
        drawBuffs();
        
        // –ú—è—á
        if (buffSystem.activeBuff && buffSystem.activeBuff.effect === 'color') {
            // –¶–≤–µ—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ drawBuffs()
        } else {
            ctx.fillStyle = ball.originalColor;
        }
        
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.size, 0, Math.PI * 2);
        ctx.fill();
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ü–≤–µ—Ç
        ctx.fillStyle = '#FFFFFF';
    }
    
    // ========== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ==========
    function gameLoop() {
        if (!game.active) return;
        
        update();
        draw();
        
        requestAnimationFrame(gameLoop);
    }
    
    // ========== –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö ==========
    window.onload = function() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const saved = localStorage.getItem('pingpongSettings');
        if (saved) {
            const settings = JSON.parse(saved);
            game.sound = settings.sound !== undefined ? settings.sound : true;
            game.showMobile = settings.showMobile !== undefined ? settings.showMobile : true;
            game.buffsEnabled = settings.buffsEnabled !== undefined ? settings.buffsEnabled : true;
            game.ballSpeed = settings.ballSpeed || 5;
            
            document.getElementById('soundToggle').checked = game.sound;
            document.getElementById('mobileButtons').checked = game.showMobile;
            document.getElementById('buffsToggle').checked = game.buffsEnabled;
            document.getElementById('ballSpeed').value = game.ballSpeed;
            document.getElementById('speedValue').textContent = game.ballSpeed;
        }
        
        // –°–∫—Ä—ã—Ç—å –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        document.getElementById('mobileControls').classList.toggle('hidden', !game.showMobile);
    };
</script>
